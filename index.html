<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spring To-Do List</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#22c55e">
  <style>
    :root{
      --bg:#f4f6f8;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --shadow: 0 6px 18px rgba(0,0,0,0.10);
      --primary:#22c55e;
      --danger:#ef4444;
      --chip:#eef2f7;
    }

    body.dark{
      --bg:#0b1220;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border:#1f2a44;
      --shadow: 0 8px 22px rgba(0,0,0,0.35);
      --primary:#22c55e;
      --danger:#fb7185;
      --chip:#111c33;
    }

    *{box-sizing:border-box;}

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 16px;
    }

    .container {
      max-width: 520px;
      margin: 0 auto;
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }

    h1 {
      font-size: 20px;
      margin: 0;
      line-height: 1.2;
    }

    .toggle {
      border: 1px solid var(--border);
      background: var(--chip);
      color: var(--text);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 14px;
      cursor: pointer;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    .row{
      display:flex;
      gap:10px;
      margin: 10px 0 14px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      outline: none;
    }

    input[type="text"]::placeholder{color:var(--muted);}

    .addBtn {
      padding: 12px 14px;
      font-size: 16px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      min-width: 110px;
    }

    .meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 8px;
    }

    .clearBtn{
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 13px;
      cursor:pointer;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 8px;
      border-bottom: 1px solid var(--border);
    }

    li:last-child{border-bottom:none;}

    .task{
      display:flex;
      align-items:center;
      gap:10px;
      flex:1;
      min-width:0;
      cursor:pointer;
    }

    .check{
      width: 22px;
      height: 22px;
      border-radius: 8px;
      border: 1.5px solid var(--border);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
      background: transparent;
    }

    li.completed .check{
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    .label{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      font-size: 16px;
    }

    li.completed .label {
      text-decoration: line-through;
      color: var(--muted);
    }

    .actions{
      display:flex;
      align-items:center;
      gap:8px;
      flex: 0 0 auto;
    }

    .delBtn {
      padding: 8px 10px;
      font-size: 14px;
      background: transparent;
      color: var(--danger);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
    }

    .empty{
      padding: 14px 8px;
      color: var(--muted);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸŒ¸ Spring To-Do List</h1>
      <button class="toggle" id="themeToggle" type="button" aria-label="Toggle dark mode">ðŸŒ™ <span id="themeLabel">Dark</span></button>
    </div>

    <div class="row">
      <input id="taskInput" type="text" placeholder="Add a new taskâ€¦" />
      <button class="addBtn" id="addBtn" type="button">Add</button>
    </div>

    <div class="meta">
      <div><span id="count">0</span> items</div>
      <button class="clearBtn" id="clearCompleted" type="button">Clear completed</button>
    </div>

    <ul id="taskList"></ul>
    <div id="emptyState" class="empty" style="display:none;">No tasks yet. Add one above ðŸ‘†</div>
  </div>

  <script>
    // --------- Autosave (localStorage) ---------
    const STORAGE_KEY = 'spring_todo_tasks_v1';
    const THEME_KEY = 'spring_todo_theme_v1';

    /** @type {{id:string, text:string, done:boolean}[]} */
    let tasks = [];

    const taskInput = document.getElementById('taskInput');
    const taskList = document.getElementById('taskList');
    const emptyState = document.getElementById('emptyState');
    const countEl = document.getElementById('count');

    function saveTasks(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function loadTasks(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        tasks = raw ? JSON.parse(raw) : [];
        if (!Array.isArray(tasks)) tasks = [];
      } catch {
        tasks = [];
      }
    }

    function uid(){
      return String(Date.now()) + '_' + Math.random().toString(16).slice(2);
    }

    function render(){
      taskList.innerHTML = '';

      if (tasks.length === 0) {
        emptyState.style.display = 'block';
      } else {
        emptyState.style.display = 'none';
      }

      for (const t of tasks){
        const li = document.createElement('li');
        if (t.done) li.classList.add('completed');

        const task = document.createElement('div');
        task.className = 'task';
        task.title = 'Tap to check off';
        task.onclick = () => toggleDone(t.id);

        const check = document.createElement('div');
        check.className = 'check';
        check.innerHTML = t.done ? 'âœ“' : '';

        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = t.text;

        task.appendChild(check);
        task.appendChild(label);

        const actions = document.createElement('div');
        actions.className = 'actions';

        const delBtn = document.createElement('button');
        delBtn.className = 'delBtn';
        delBtn.type = 'button';
        delBtn.textContent = 'Remove';
        delBtn.onclick = (e) => { e.stopPropagation(); removeTask(t.id); };

        actions.appendChild(delBtn);

        li.appendChild(task);
        li.appendChild(actions);
        taskList.appendChild(li);
      }

      countEl.textContent = String(tasks.length);
    }

    function addTask(){
      const text = taskInput.value.trim();
      if (!text) return;
      tasks.unshift({ id: uid(), text, done: false });
      taskInput.value = '';
      saveTasks();
      render();
    }

    function toggleDone(id){
      const t = tasks.find(x => x.id === id);
      if (!t) return;
      t.done = !t.done;
      saveTasks();
      render();
    }

    function removeTask(id){
      tasks = tasks.filter(x => x.id !== id);
      saveTasks();
      render();
    }

    function clearCompleted(){
      tasks = tasks.filter(x => !x.done);
      saveTasks();
      render();
    }

    // --------- Dark Mode ---------
    const themeToggle = document.getElementById('themeToggle');
    const themeLabel = document.getElementById('themeLabel');

    function setTheme(mode){
      const isDark = mode === 'dark';
      document.body.classList.toggle('dark', isDark);
      localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
      themeToggle.firstChild.textContent = isDark ? 'â˜€ï¸ ' : 'ðŸŒ™ ';
      themeLabel.textContent = isDark ? 'Light' : 'Dark';
    }

    function loadTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      if (saved === 'dark' || saved === 'light') {
        setTheme(saved);
        return;
      }
      // If no saved preference, follow device setting
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      setTheme(prefersDark ? 'dark' : 'light');
    }

    themeToggle.addEventListener('click', () => {
      const isDark = document.body.classList.contains('dark');
      setTheme(isDark ? 'light' : 'dark');
    });

    // --------- Wire up UI ---------
    document.getElementById('addBtn').addEventListener('click', addTask);
    document.getElementById('clearCompleted').addEventListener('click', clearCompleted);

    taskInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addTask();
    });

    // Init
    loadTheme();
    loadTasks();
    render();
  </script>
</body>
</html>
